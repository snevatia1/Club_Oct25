<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Mahabaleshwar Demo Booking</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Arial, sans-serif; background: #f0f0f0; }
        .app { display: grid; grid-template-columns: 1fr 1fr; height: 100vh; }
        .left-pane { overflow-y: auto; padding: 10px; background: #f9f9f9; }
        .right-pane { overflow-y: auto; padding: 10px; background: white; }
        .header { background: #cc3333; color: white; padding: 10px; position: sticky; top: 0; z-index: 1; text-align: center; }
        .month { margin-bottom: 15px; } /* Reduced margin */
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #ddd; }
        .date-cell { background: white; padding: 2px; text-align: center; cursor: pointer; height: 35px; border: 1px solid #ddd; font-size: 14px; position: relative; display: flex; flex-direction: column; justify-content: space-between; } /* Tighter, positioned */
        .date-num { font-size: 16px; font-weight: bold; align-self: flex-start; } /* Top-left date */
        .room-qty { font-size: 12px; align-self: flex-end; } /* Bottom-right qty */
        .date-cell:hover { background: #e0e0e0; }
        .weekend { background: lightyellow !important; }
        .season { background: gold !important; }
        .special { background: red !important; color: white !important; }
        .selected { background: lightblue !important; }
        .error { color: red; }
        .section { margin-bottom: 10px; padding: 8px; border: 1px solid #ddd; } /* Tighter sections */
        .party-row { display: flex; justify-content: space-around; margin: 3px 0; flex-wrap: wrap; } /* Reduced vertical */
        .filter-row { display: flex; justify-content: space-around; margin: 3px 0; flex-wrap: wrap; }
        select, input { margin: 2px; padding: 3px; width: 50px; font-size: 12px; } /* Compact */
        .block-btn { background: #ccc; margin: 1px; padding: 4px; cursor: pointer; font-size: 12px; }
        #roomList { max-height: 100px; overflow-x: auto; white-space: nowrap; } /* Horizontal row, min scroll */
        .room-item { display: inline-block; border: 1px solid #ddd; padding: 4px; margin: 2px; background: #f9f9f9; font-size: 12px; min-width: 80px; }
        .selected-room { background: lightgreen; }
        .sticky-summary { position: sticky; bottom: 0; background: white; border-top: 2px solid #cc3333; padding: 10px; font-size: 12px; } /* Compact summary */
        button { background: #cc3333; color: white; border: none; padding: 4px 8px; cursor: pointer; margin: 1px; font-size: 12px; }
        .rules-text { max-height: 120px; overflow: auto; border: 1px solid #ccc; padding: 8px; font-size: 11px; background: #f9f9f9; }
        @media (max-width: 768px) { .app { grid-template-columns: 1fr; } .party-row, .filter-row { flex-direction: column; align-items: center; } #roomList { white-space: normal; } }
    </style>
</head>
<body>
    <div class="app">
        <div class="left-pane">
            <div class="header" id="header">Loading...</div>
            <div id="calendar"></div>
        </div>
        <div class="right-pane" id="rightPane">
            <div id="otpGate" class="section" style="display:none;"></div>
            <div id="mainContent" style="display:block;">
                <p style="background:#e0f7e0; padding:5px; font-size:12px; margin:0;">Demo: Logged in as ABC (Mem#123).</p>
                <div class="section">
                    <h3 style="margin:5px 0; font-size:14px;">Dates</h3>
                    <p id="datesDisplay" style="font-size:12px; margin:5px 0;">Check-in: ? | Check-out: ?</p>
                </div>
                <div class="section">
                    <h3 style="margin:5px 0; font-size:14px;">Party Size</h3>
                    <div class="party-row">
                        <label>Members: <input type="number" id="members" min="0" value="0" onchange="updateParty()"></label>
                        <label>Seniors: <input type="number" id="seniors" min="0" value="0" onchange="updateParty()"></label>
                    </div>
                    <div class="party-row">
                        <label>Children <10: <input type="number" id="kidsU10" min="0" value="0" onchange="updateParty()"></label>
                        <label>Deps 10-21: <input type="number" id="deps" min="0" value="0" onchange="updateParty()"></label>
                    </div>
                    <div class="party-row">
                        <label>Temp Adults: <input type="number" id="tempA" min="0" value="0" onchange="updateParty()"></label>
                        <label>Temp Kids: <input type="number" id="tempK" min="0" value="0" onchange="updateParty()"></label>
                    </div>
                    <div class="party-row">
                        <label>Group: <input type="number" id="group" min="0" max="19" value="0" onchange="updateParty()"></label>
                    </div>
                    <p style="font-size:11px; margin:3px 0;">Deps/Children billed as Temp. Group min 10 if >0.</p>
                </div>
                <div class="section">
                    <h3 style="margin:5px 0; font-size:14px;">Filters (# Rooms)</h3>
                    <div class="filter-row">
                        <label>Wheel: <select id="wheel" onchange="updateFilters()"><option value="0">0</option></select></label>
                        <label>Pet: <select id="pet" onchange="updateFilters()"><option value="0">0</option></select></label>
                        <label>AC: <select id="ac" onchange="updateFilters()"><option value="0">0</option></select></label>
                    </div>
                    <div class="filter-row">
                        <label>Single: <select id="single" onchange="updateFilters()"><option value="0">0</option></select></label>
                        <label>4 Beds: <select id="quad" onchange="updateFilters()"><option value="0">0</option></select></label>
                    </div>
                    <p id="filterCounts" style="font-size:12px; margin:5px 0;">Matching: 39 rooms</p>
                </div>
                <div class="section">
                    <h3 style="margin:5px 0; font-size:14px;">Availability</h3>
                    <div id="blockChips"></div>
                    <p style="font-size:11px; margin:3px 0;">Click block for rooms (horizontal list).</p>
                    <div id="roomList"></div>
                </div>
                <div class="section">
                    <h3 style="margin:5px 0; font-size:14px;">Meals</h3>
                    <label style="display:inline-block; margin:2px;">Veg: <input type="number" id="veg" min="0" value="0" onchange="updateMeals()"></label>
                    <label style="display:inline-block; margin:2px;">Non-Veg: <input type="number" id="nonveg" min="0" value="0" onchange="updateMeals()"></label>
                    <p id="mealsError" class="error" style="font-size:11px; margin:3px 0;"></p>
                </div>
                <div class="sticky-summary section">
                    <h3 style="margin:5px 0; font-size:14px;">Summary</h3>
                    <p id="summaryDates" style="font-size:12px; margin:2px 0;"></p>
                    <p id="summaryParty" style="font-size:12px; margin:2px 0;"></p>
                    <p id="summaryRooms" style="font-size:12px; margin:2px 0;">Rooms: 0 selected</p>
                    <p id="summaryFilters" style="font-size:12px; margin:2px 0;">Filters: None</p>
                    <p id="summaryTotal" style="font-size:12px; margin:2px 0;">Est. Total: â‚¹0</p>
                    <p id="disclaimer" style="font-size:11px; margin:2px 0;"></p>
                    <button onclick="toggleRules()" style="font-size:11px;">Rules</button>
                    <div id="rulesPanel" class="rules-text" style="display:none;"></div>
                    <label style="display:inline-block; margin:2px;"><input type="checkbox" id="accept" onchange="updateSummary()"> Accept</label>
                    <button onclick="confirmBooking()" id="confirmBtn" disabled style="font-size:11px;">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let data = {/* Inline fallback as before */};
        let state = { checkIn: null, checkOut: null, party: {members:0,seniors:0,kidsU10:0,deps:0,tempA:0,tempK:0,group:0}, filters: {wheel:0,pet:0,ac:0,single:0,quad:0,groupR:0}, verified: true, veg:0, nonveg:0, accept: false, selected: [], selectedRooms: 0 };
        const currentDate = new Date('2025-10-26');
        const blocks = ['A', 'B', 'Old C', 'New C', 'D', 'Old E', 'New E'];

        fetch('data.json').then(r=>r.json()).then(d=>{data=d;init();}).catch(()=>{init();});

        function init() {
            document.getElementById('header').innerText = data.policy.messages.header;
            document.getElementById('disclaimer').innerText = data.policy.messages.disclaimer;
            document.getElementById('rulesPanel').innerText = data.rules;
            generateCalendar();
            updateFilters();
            updateSummary();
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('otpGate').style.display = 'none';
            document.getElementById('rightPane').classList.remove('locked');
        }

        function generateCalendar() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            let month = new Date('2025-10-01');
            for (let m = 0; m < 6; m++) {
                const div = document.createElement('div'); div.className = 'month';
                div.innerHTML = `<h3 style="font-size:14px; margin:5px 0;">${month.toLocaleDateString('en-US',{month:'long',year:'numeric'})}</h3><div class="grid">${['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=>`<div style="font-size:11px;">${d}</div>`).join('')}</div>`;
                const grid = div.querySelector('.grid');
                for (let i = 0; i < 42; i++) {
                    const date = new Date(month.getFullYear(), month.getMonth(), 1); // Fix date creation
                    date.setDate(i + 1 - date.getDay()); // Proper day calc
                    if (date.getMonth() !== month.getMonth()) { grid.innerHTML += '<div></div>'; continue; }
                    const cell = document.createElement('div'); cell.className = 'date-cell';
                    cell.innerHTML = `<div class="date-num">${date.getDate()}</div><div class="room-qty">39</div>`; // Positioned
                    if (isWeekend(date)) cell.classList.add('weekend');
                    const seasonTag = getSeasonTag(date);
                    if (seasonTag) cell.classList.add(seasonTag);
                    if (state.checkIn && state.checkOut && date >= state.checkIn && date <= state.checkOut) cell.classList.add('selected');
                    cell.onclick = () => selectDate(new Date(date)); // Clone
                    grid.appendChild(cell);
                }
                cal.appendChild(div);
                month.setMonth(month.getMonth() + 1);
            }
        }

        function selectDate(date) {
            if (!state.checkIn || date < state.checkIn) {
                state.checkIn = date;
                state.checkOut = null;
            } else if (!state.checkOut) {
                state.checkOut = date;
            } else if (date > state.checkOut) {
                state.checkOut = date;
            } else {
                state.checkIn = date;
                state.checkOut = null;
            }
            generateCalendar();
            updateSummary();
            updateDatesDisplay();
        }

        function updateDatesDisplay() {
            const inStr = state.checkIn ? state.checkIn.toLocaleDateString() : '?';
            const outStr = state.checkOut ? state.checkOut.toLocaleDateString() : '?';
            document.getElementById('datesDisplay').innerText = `Check-in: ${inStr} | Check-out: ${outStr}`;
        }

        // ... (rest of functions same as previous, with group added to party/state/updateParty: state.party.group = +document.getElementById('group').value; if (state.party.group > 0 && state.party.group < 10) alert('Group min 10'); estRooms += state.party.group; )

        function updateParty() {
            state.party.members = +document.getElementById('members').value;
            state.party.seniors = +document.getElementById('seniors').value;
            state.party.kidsU10 = +document.getElementById('kidsU10').value;
            state.party.deps = +document.getElementById('deps').value;
            state.party.tempA = +document.getElementById('tempA').value;
            state.party.tempK = +document.getElementById('tempK').value;
            state.party.group = +document.getElementById('group').value;
            if (state.party.group > 0 && state.party.group < 10) { alert('Group min 10 rooms'); document.getElementById('group').value = 0; state.party.group = 0; }
            // ... (rules check same, estRooms = Math.ceil((Object.values(state.party).reduce((a,b)=>a+b,0) - state.party.group) / 2) + state.party.group; )
            updateSummary(); updateMeals();
        }

        // In updateSummary, summaryParty includes `Group: ${state.party.group}`

        // Room list: Already horizontal (#roomList overflow-x: auto; white-space: nowrap; .room-item inline-block)

        // Other functions unchanged
    </script>
</body>
</html>
