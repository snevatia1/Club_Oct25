<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Mahabaleshwar Bookings</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Arial, sans-serif; background: #f0f0f0; }
        .app { display: grid; grid-template-columns: 1fr 1fr; height: 100vh; }
        .logo { width: 100%; height: auto; grid-column: 1 / -1; } /* Add <img src="logo.jpg"> if file exists */
        .left-pane { overflow-y: auto; padding: 10px; background: #f9f9f9; }
        .right-pane { overflow-y: auto; padding: 10px; background: white; }
        .right-pane.locked { opacity: 0.5; pointer-events: none; }
        .header { background: #c00; color: white; padding: 10px; position: sticky; top: 0; z-index: 1; text-align: center; }
        .month { margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #ddd; }
        .date-cell { background: white; padding: 5px; text-align: center; cursor: pointer; min-height: 40px; border: 1px solid #ddd; }
        .date-cell:hover { background: #e0e0e0; }
        .weekend { background: lightyellow !important; }
        .season { background: gold !important; }
        .special { background: red !important; color: white !important; }
        .selected { background: lightblue !important; }
        .error { color: red; }
        .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; }
        .sticky-summary { position: sticky; bottom: 0; background: white; border-top: 2px solid #c00; padding: 15px; }
        button { background: #c00; color: white; border: none; padding: 5px 10px; cursor: pointer; margin: 2px; }
        input { margin: 5px; padding: 5px; width: 60px; }
        .rules-text { max-height: 150px; overflow: auto; border: 1px solid #ccc; padding: 10px; font-size: 12px; background: #f9f9f9; }
        @media (max-width: 768px) { .app { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="app">
        <!-- Logo: Uncomment if logo.jpg in folder -->
        <!-- <img src="logo.jpg" alt="Club Logo" class="logo" onerror="this.style.display='none'"> -->
        <div class="left-pane">
            <div class="header" id="header"></div>
            <div id="calendar"></div>
        </div>
        <div class="right-pane" id="rightPane">
            <div id="otpGate" class="section">
                <h3>OTP Verification (Demo: Mem# 123, OTP 1234)</h3>
                <input id="memNo" placeholder="Membership No" />
                <button onclick="sendOtp()">Send OTP</button>
                <input id="otpInput" placeholder="Enter OTP" style="display:none;" />
                <button id="verifyBtn" onclick="verifyOtp()" style="display:none;">Verify</button>
                <p id="duesError" class="error" style="display:none;"></p>
            </div>
            <div id="mainContent" style="display:none;">
                <div class="section">
                    <h3>Party Size</h3>
                    <label>Members: <input type="number" id="members" min="0" value="0" onchange="updateParty()"></label>
                    <label>Seniors: <input type="number" id="seniors" min="0" value="0" onchange="updateParty()"></label>
                    <label>Children <10: <input type="number" id="kidsU10" min="0" value="0" onchange="updateParty()"></label>
                    <label>Dependants 10-21: <input type="number" id="deps" min="0" value="0" onchange="updateParty()"></label>
                    <label>Temp Adults: <input type="number" id="tempA" min="0" value="0" onchange="updateParty()"></label>
                    <label>Temp Kids 5-10: <input type="number" id="tempK" min="0" value="0" onchange="updateParty()"></label>
                    <p>Children (11–21) and Parents are Dependants, billed as Temp Members.</p>
                </div>
                <div class="section">
                    <h3>Filters</h3>
                    <label><input type="checkbox" id="wheel" onchange="updateFilters()"> Wheelchair</label>
                    <label><input type="checkbox" id="pet" onchange="updateFilters()"> Pet</label>
                    <label><input type="checkbox" id="ac" onchange="updateFilters()"> AC</label>
                    <label><input type="checkbox" id="single" onchange="updateFilters()"> Single</label>
                    <label><input type="checkbox" id="quad" onchange="updateFilters()"> 4 Beds</label>
                    <label>Group Rooms: <input type="number" id="groupR" min="0" value="0" onchange="updateFilters()"></label>
                    <p id="filterCounts"></p>
                </div>
                <div class="section">
                    <h3>Availability (Stub: 39 total)</h3>
                    <p id="blockSummary">A: 9, B: 9, Old C: 6, New C: 4, D: 4, Old E: 3, New E: 4 (after filters)</p>
                    <p>Partial rooms: Auto-chain suggested for spans.</p>
                </div>
                <div class="section">
                    <h3>Meals</h3>
                    <label>Veg: <input type="number" id="veg" min="0" value="0" onchange="updateMeals()"></label>
                    <label>Non-Veg: <input type="number" id="nonveg" min="0" value="0" onchange="updateMeals()"></label>
                    <p id="mealsError" class="error"></p>
                </div>
                <div class="sticky-summary section">
                    <h3>Summary</h3>
                    <p id="summaryDates"></p>
                    <p id="summaryParty"></p>
                    <p id="summaryRooms">Rooms: 0 selected</p>
                    <p id="summaryFilters"></p>
                    <p id="summaryTotal">Est. Total: ₹0</p>
                    <p id="disclaimer"></p>
                    <button onclick="toggleRules()">Rules</button>
                    <div id="rulesPanel" class="rules-text" style="display:none;"></div>
                    <label><input type="checkbox" id="accept" onchange="updateSummary()"> I Accept</label>
                    <button onclick="confirmBooking()" id="confirmBtn" disabled>Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let data = {}; // Loaded from data.json
        let state = { checkIn: null, checkOut: null, party: {members:0,seniors:0,kidsU10:0,deps:0,tempA:0,tempK:0}, filters: {wheel:false,pet:false,ac:false,single:false,quad:false,groupR:0}, verified: false, veg:0, nonveg:0, accept: false, selectedRooms: 0 };
        const currentDate = new Date('2025-10-25'); // Fixed

        // Load data
        fetch('data.json').then(r => r.json()).then(d => { data = d; init(); });

        function init() {
            document.getElementById('header').innerText = data.policy.messages.header;
            document.getElementById('disclaimer').innerText = data.policy.messages.disclaimer;
            generateCalendar();
            updateSummary();
        }

        // Calendar
        function generateCalendar() {
            const cal = document.getElementById('calendar');
            cal.innerHTML = '';
            let month = new Date('2025-10-01');
            for (let m = 0; m < 6; m++) {
                const div = document.createElement('div'); div.className = 'month';
                div.innerHTML = `<h3>${month.toLocaleDateString('en-US', {month:'long', year:'numeric'})}</h3>
                    <div class="grid">${['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d => `<div>${d}</div>`).join('')}</div>`;
                const grid = div.querySelector('.grid');
                for (let i = 0; i < 42; i++) {
                    const date = new Date(month); date.setDate(1); date.setDate(date.getDate() + i - date.getDay());
                    if (date.getMonth() !== month.getMonth()) { grid.innerHTML += '<div></div>'; continue; }
                    const cell = document.createElement('div'); cell.className = 'date-cell';
                    cell.innerHTML = `${date.getDate()}<div>Free: ${data.rooms.length - Math.floor(Math.random()*8)}</div>`; // Stub free
                    if (isWeekend(date)) cell.classList.add('weekend');
                    if (isSeasonOrSpecial(date)) {
                        const tag = getSeasonTag(date); cell.classList.add(tag === 'special' ? 'special' : 'season');
                    }
                    if (state.checkIn && state.checkOut && date >= state.checkIn && date <= state.checkOut) cell.classList.add('selected');
                    cell.onclick = () => selectDate(date);
                    grid.appendChild(cell);
                }
                cal.appendChild(div);
                month.setMonth(month.getMonth() + 1);
            }
        }

        function selectDate(date) {
            if (!state.checkIn) { state.checkIn = date; }
            else if (!state.checkOut || date <= state.checkIn) { state.checkOut = null; state.checkIn = date; }
            else state.checkOut = date;
            generateCalendar(); updateSummary();
        }

        function isWeekend(d) { return d.getDay() === 0 || d.getDay() === 6; }
        function isSeasonOrSpecial(d) {
            return data.seasons.some(s => {
                const from = new Date(s.from), to = new Date(s.to);
                return d >= from && d <= to;
            });
        }
        function getSeasonTag(d) { /* Stub: return 'season' or 'special' */ return 'season'; }

        // OTP
        function sendOtp() {
            const mem = document.getElementById('memNo').value;
            if (data.dues[mem] > 0) { document.getElementById('duesError').innerText = data.policy.messages.dues_pending; return; }
            document.getElementById('otpInput').style.display = 'inline'; document.getElementById('verifyBtn').style.display = 'inline';
        }
        function verifyOtp() {
            if (document.getElementById('otpInput').value === '1234') {
                state.verified = true; document.getElementById('mainContent').style.display = 'block'; document.getElementById('otpGate').style.display = 'none';
                document.getElementById('rightPane').classList.remove('locked');
            }
        }

        // Party/Filters/Meals
        function updateParty() { state.party = {members: +document.getElementById('members').value, seniors: +document.getElementById('seniors').value, kidsU10: +document.getElementById('kidsU10').value, deps: +document.getElementById('deps').value, tempA: +document.getElementById('tempA').value, tempK: +document.getElementById('tempK').value }; updateSummary(); }
        function updateFilters() { state.filters = {wheel: document.getElementById('wheel').checked, pet: document.getElementById('pet').checked, ac: document.getElementById('ac').checked, single: document.getElementById('single').checked, quad: document.getElementById('quad').checked, groupR: +document.getElementById('groupR').value }; document.getElementById('filterCounts').innerText = `Matching: ${filterRooms().length} rooms`; updateSummary(); }
        function updateMeals() { state.veg = +document.getElementById('veg').value; state.nonveg = +document.getElementById('nonveg').value; const total = Object.values(state.party).reduce((a,b)=>a+b,0); if (state.veg + state.nonveg !== total) document.getElementById('mealsError').innerText = data.policy.messages.meals_mismatch; else document.getElementById('mealsError').innerText = ''; updateSummary(); }

        function filterRooms() { return data.rooms.filter(r => (!state.filters.wheel || r.wheelchair) && (!state.filters.pet || r.pet) && (!state.filters.ac || r.ac) && (!state.filters.single || r.type === 'single') && (!state.filters.quad || r.type === 'quad')); }

        // Summary & Confirm
        function updateSummary() {
            const totalP = Object.values(state.party).reduce((a,b)=>a+b,0);
            document.getElementById('summaryDates').innerText = `Dates: ${state.checkIn ? state.checkIn.toLocaleDateString() : '?'} to ${state.checkOut ? state.checkOut.toLocaleDateString() : '?'} (${state.checkIn ? state.checkIn.toISOString() : ''})`;
            document.getElementById('summaryParty').innerText = `Occupants: Total ${totalP} (Members ${state.party.members + state.party.seniors}, Children/Deps ${state.party.kidsU10 + state.party.deps}, Temp ${state.party.tempA + state.party.tempK})`;
            document.getElementById('summaryRooms').innerText = `Rooms: ${state.selectedRooms || filterRooms().length / 3} avail (select via blocks)`;
            document.getElementById('summaryFilters').innerText = `Filters: ${Object.entries(state.filters).filter(([k,v])=>v&&k!=='groupR').map(([k])=>k).join(', ')}`;
            document.getElementById('summaryTotal').innerText = `Est. Total: ₹${totalP * 5250 * (state.checkOut ? (state.checkOut - state.checkIn)/86400000 : 1)}`; // Stub calc
            document.getElementById('confirmBtn').disabled = !state.accept || totalP === 0 || !state.checkIn || !state.checkOut || (state.veg + state.nonveg !== totalP);
        }
        function toggleRules() { const p = document.getElementById('rulesPanel'); p.style.display = p.style.display === 'none' ? 'block' : 'none'; if (p.innerText === '') p.innerText = data.rules; }
        function confirmBooking() { alert('Booking confirmed! Email/PDF sent (stub). Club will reply.'); console.log('PDF data:', state); if (isSeason(state.checkIn)) alert('Courier signed form 15 days ahead.'); }

        // Validation stubs
        function isSeason(d) { return data.seasons.some(s => d >= new Date(s.from) && d <= new Date(s.to)); }
    </script>
</body>
</html>
