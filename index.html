<!-- Assume this is index.html, and roomsData is imported/defined using your CSV contents. 
You may use a conversion tool or copy-paste "roomsData" as a JS array of objects. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Mahabaleshwar Booking Demo</title>
    <style>
        /* ...Your previous and above CSS, plus .block-btn styles... */
        .block-btn { background: #ddd; margin: 6px 0; font-weight: bold; padding: 8px 12px; border-radius: 5px;}
        .room-item { margin-bottom: 8px; }
        .room-qty { font-size: 18px; color: #cc3333; font-weight: bold;}
        .selected-room { background: #d7ffd7; }
    </style>
</head>
<body>
<div class="app">
    <div class="left-pane">
        <div class="header" id="header"></div>
        <div id="calendar"></div>
    </div>
    <div class="right-pane" id="rightPane">
        <div id="mainContent">
            <div class="section">
                <h3>Dates</h3>
                <p id="datesDisplay">Check-in: ? | Check-out: ?</p>
            </div>
            <div class="section">
                <h3>Party Size</h3>
                <div class="party-row">
                    <label>Member 21â€“64:<input type="number" id="members" min="0" value="0" onchange="updateParty()"></label>
                    <label>Member 65+:<input type="number" id="seniors" min="0" value="0" onchange="updateParty()"></label>
                    <label>M Child 11-21:<input type="number" id="mchild" min="0" value="0" onchange="updateParty()"></label>
                    <label>Children &lt;10:<input type="number" id="kidsU10" min="0" value="0" onchange="updateParty()"></label>
                </div>
                <div class="party-row">
                    <label>Parents:<input type="number" id="parents" min="0" value="0" onchange="updateParty()"></label>
                    <label>Temp Members:<input type="number" id="tempMembers" min="0" value="0" onchange="updateParty()"></label>
                    <label>Group:<input type="number" id="group" min="10" max="19" value="0" onchange="updateParty()"></label>
                </div>
            </div>
            <div class="section">
                <h3>Room Filters</h3>
                <div class="filter-row">
                    <label>Wheelchair: <select id="wheel" onchange="updateFilters()"></select></label>
                    <label>AC: <select id="ac" onchange="updateFilters()"></select></label>
                    <label>Pets: <select id="pets" onchange="updateFilters()"></select></label>
                    <label>Group: <select id="groupF" onchange="updateFilters()"></select></label>
                </div>
            </div>
            <div class="section">
                <h3>Block Select</h3>
                <div id="blockChips"></div>
            </div>
            <div class="section">
                <h3>Available Rooms</h3>
                <div id="roomList"></div>
            </div>
            <div class="section">
                <h3>Selected Rooms & Occupants</h3>
                <div id="selectedRoomsList"></div>
            </div>
            <!-- Meals, Summary, Rules, etc., as previously coded -->
        </div>
    </div>
</div>
<script>
    // Replace below with programmatic CSV parse output:
    const roomsData = [
        {Block:"A",Room:"A-1",Min:1,Max:2,AC:"No",Wheel:"Yes",Pets:"No",Group:"Yes"},
        {Block:"A",Room:"A-2",Min:2,Max:4,AC:"No",Wheel:"Yes",Pets:"No",Group:"Yes"},
        // ...continue for all CSV rows...
    ];

    let filters = {wheel: "", ac: "", pets: "", groupF: ""};
    let state = {party: {members:0, seniors:0, mchild:0, kidsU10:0, parents:0, tempMembers:0, group:0}, selectedRooms: [], roomOccupants: {}};
    let chosenBlock = "";

    function updateParty() {
        state.party.members = parseInt(document.getElementById('members').value) || 0;
        state.party.seniors = parseInt(document.getElementById('seniors').value) || 0;
        state.party.mchild = parseInt(document.getElementById('mchild').value) || 0;
        state.party.kidsU10 = parseInt(document.getElementById('kidsU10').value) || 0;
        state.party.parents = parseInt(document.getElementById('parents').value) || 0;
        state.party.tempMembers = parseInt(document.getElementById('tempMembers').value) || 0;
        state.party.group = parseInt(document.getElementById('group').value) || 0;
        // enforce rules as needed...
    }

    function updateFilters() {
        filters.wheel = document.getElementById('wheel').value;
        filters.ac = document.getElementById('ac').value;
        filters.pets = document.getElementById('pets').value;
        filters.groupF = document.getElementById('groupF').value;
        renderBlocks();
    }

    // Dynamically populate filter options
    function populateFilters() {
        function fillSelect(id, values) {
            const sel = document.getElementById(id);
            sel.innerHTML = `<option value="">All</option>`;
            [...new Set(values)].forEach(v => sel.innerHTML += `<option value="${v}">${v}</option>`);
        }
        fillSelect("wheel", roomsData.map(r=>r.Wheel));
        fillSelect("ac", roomsData.map(r=>r.AC));
        fillSelect("pets", roomsData.map(r=>r.Pets));
        fillSelect("groupF", roomsData.map(r=>r.Group));
    }

    // Show block buttons with available counts
    function renderBlocks() {
        let filtered = roomsData.filter(room =>
            (filters.wheel === "" || room.Wheel === filters.wheel) &&
            (filters.ac === "" || room.AC === filters.ac) &&
            (filters.pets === "" || room.Pets === filters.pets) &&
            (filters.groupF === "" || room.Group === filters.groupF)
        );
        let blockCounts = {};
        filtered.forEach(r => blockCounts[r.Block] = (blockCounts[r.Block] || 0) + 1);
        let container = document.getElementById('blockChips');
        container.innerHTML = '';
        Object.entries(blockCounts).forEach(([block, count]) => {
            let btn = document.createElement('button');
            btn.className = 'block-btn';
            btn.innerHTML = `${block} <span class="room-qty">${count}</span>`;
            btn.onclick = () => { chosenBlock = block; renderRooms(); };
            container.appendChild(btn);
        });
    }

    // Show rooms in chosen block after filters
    function renderRooms() {
        let filtered = roomsData.filter(room =>
            room.Block === chosenBlock &&
            (filters.wheel === "" || room.Wheel === filters.wheel) &&
            (filters.ac === "" || room.AC === filters.ac) &&
            (filters.pets === "" || room.Pets === filters.pets) &&
            (filters.groupF === "" || room.Group === filters.groupF)
        );
        let container = document.getElementById('roomList');
        container.innerHTML = '';
        filtered.forEach((room, i) => {
            let div = document.createElement('div');
            div.className = 'room-item';
            div.innerHTML = `Room ${room.Room} (Max: ${room.Max}) <button onclick="selectRoom('${room.Room}', ${room.Max})">Select</button>`;
            container.appendChild(div);
        });
    }

    // Handle room selection and occupant limits per room
    function selectRoom(roomNo, maxOcc) {
        if (!state.selectedRooms.some(r=>r.roomNo===roomNo)) {
            state.selectedRooms.push({roomNo, maxOcc});
            renderSelectedRooms();
        }
    }

    function renderSelectedRooms() {
        let el = document.getElementById('selectedRoomsList');
        el.innerHTML = '';
        state.selectedRooms.forEach((r, idx) => {
            el.innerHTML += `<span>Room ${r.roomNo}: 
                Occupants <select onchange="setRoomOccupant(${idx}, this.value)">
                    ${Array.from({length:r.maxOcc+1},(_,i)=>`<option value="${i}">${i}</option>`).join('')}
                </select>&nbsp;
            </span>`;
        });
    }

    function setRoomOccupant(idx, occ) {
        state.roomOccupants[idx] = parseInt(occ);
        // further validation/rules as needed
    }

    // Initial setup
    populateFilters(); renderBlocks();

    // Ensure when the page loads, blocks and filter selectors reflect real room/CSV info.
</script>
</body>
</html>
