<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Club Mahabaleshwar Demo Booking</title>
<style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f0f0f0; }
    .app { display: grid; grid-template-columns: 0.4fr 0.6fr; height: 100vh; }
    .left-pane { overflow-y: auto; padding: 10px; background: #f9f9f9; }
    .right-pane { overflow-y: auto; padding: 10px; background: white; }
    .header { background: #cc3333; color: white; padding: 10px; position: sticky; top: 0; z-index: 1; text-align: center; }
    .month { margin-bottom: 15px; }
    .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #ddd; }
    .date-cell { background: white; padding: 4px; text-align: center; cursor: pointer; height: 45px; border: 1px solid #ddd; position: relative; display: flex; flex-direction: column; justify-content: space-between; font-size: 15px; }
    .date-num { font-size: 20px; font-weight: bold; align-self: flex-start; }
    .room-qty { font-size: 18px; align-self: flex-end; color: #333; }
    .old-date { background: #bababa !important; color:#666;}
    .weekend { background: lightyellow !important; }
    .season { background: gold !important; }
    .special { background: red !important; color: white !important; }
    .selected { background: lightblue !important; }
    .error { color: red; }
    .section { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; }
    .party-row { display: flex; justify-content: space-around; margin: 5px 0; flex-wrap: wrap; }
    .filter-row { display: flex; justify-content: space-around; margin: 5px 0; flex-wrap: wrap; }
    select, input { margin: 5px; padding: 5px; width: 60px; }
    .block-btn { background: #ccc; margin: 2px; padding: 5px; cursor: pointer; }
    #roomList { max-height: 200px; overflow: auto; }
    .room-item { border: 1px solid #ddd; padding: 5px; margin: 2px; background: #f9f9f9; display: inline-block; min-width: 80px; }
    .selected-room { background: lightgreen; }
    .sticky-summary { position: sticky; bottom: 0; background: white; border-top: 2px solid #cc3333; padding: 15px; }
    button { background: #cc3333; color: white; border: none; padding: 5px 10px; cursor: pointer; margin: 2px; }
    .rules-text { max-height: 150px; overflow: auto; border: 1px solid #ccc; padding: 10px; font-size: 12px; background: #f9f9f9; }
    .summary-box { display: flex; align-items: center; gap: 12px; padding:5px;}
    @media (max-width: 768px) { .app { grid-template-columns: 1fr; } .party-row, .filter-row { flex-direction: column; } }
</style>
</head>
<body>
<div class="app">
    <div class="left-pane">
        <div class="header" id="header"></div>
        <div id="calendar"></div>
    </div>
    <div class="right-pane" id="rightPane">
        <div id="otpGate" class="section" style="display:none;"></div>
        <div id="mainContent" style="display:block;">
            <p style="background:#e0f7e0; padding:5px;">Demo: Logged in as ABC (Mem#123) – OTP assumed received.</p>
            <div class="section">
                <h3>Dates</h3>
                <p id="datesDisplay">Check-in: ? | Check-out: ?</p>
            </div>
            <div class="section">
                <h3>Party Size</h3>
                <div class="party-row">
                    <label>Member 21–64:<input type="number" id="members" min="0" value="0" onchange="updateParty()"></label>
                    <label>Member 65+:<input type="number" id="seniors" min="0" value="0" onchange="updateParty()"></label>
                    <label>Children &lt;10:<input type="number" id="kidsU10" min="0" value="0" onchange="updateParty()"></label>
                </div>
                <div class="party-row">
                    <label>Parents:<input type="number" id="parents" min="0" value="0" onchange="updateParty()"></label>
                    <label>Temp Members:<input type="number" id="tempMembers" min="0" value="0" onchange="updateParty()"></label>
                    <label>Group:<input type="number" id="group" min="10" max="19" value="0" onchange="updateParty()"></label>
                </div>
                <p>Parents and children 11–21 are treated as Parents for booking and billing as per rules.</p>
            </div>
            <div class="section">
                <h3>Filters (# Rooms)</h3>
                <div class="filter-row">
                    <label>Wheelchair: <select id="wheel" onchange="updateFilters()"><option value="0">0</option></select></label>
                    <label>Pets: <select id="pet" onchange="updateFilters()"><option value="0">0</option></select></label>
                    <label>AC: <select id="ac" onchange="updateFilters()"><option value="0">0</option></select></label>
                </div>
                <div class="filter-row">
                    <label>Single: <select id="single" onchange="updateFilters()"><option value="0">0</option></select></label>
                    <label>4 Beds: <select id="quad" onchange="updateFilters()"><option value="0">0</option></select></label>
                    <label>Group Rooms: <select id="groupR" onchange="updateFilters()"><option value="0">0</option></select></label>
                </div>
                <p id="filterCounts">Matching: 39 rooms</p>
            </div>
            <div class="section">
                <h3>Availability (After Filters & Selected)</h3>
                <div id="blockChips"></div>
                <div id="roomList"></div>
            </div>
            <div class="section">
                <h3>Selected Rooms</h3>
                <div id="selectedRoomsList" class="summary-box"></div>
            </div>
            <div class="section">
                <h3>Occupants per Room</h3>
                <div id="roomsOccupantsBox" class="summary-box"></div>
            </div>
            <div class="section">
                <h3>Meals</h3>
                <label>Veg: <input type="number" id="veg" min="0" value="0" onchange="updateMeals()"></label>
                <label>Non-Veg: <input type="number" id="nonveg" min="0" value="0" onchange="updateMeals()"></label>
                <p id="mealsError" class="error"></p>
            </div>
            <div class="sticky-summary section">
                <h3>Summary</h3>
                <p id="summaryDates"></p>
                <p id="summaryParty"></p>
                <p id="summaryRooms"></p>
                <p id="summaryFilters"></p>
                <p id="summaryTotal"></p>
                <div id="disclaimer"></div>
                <a href="#" onclick="toggleRules()">Rules (Cancellation + Dress Code)</a>
                <div id="rulesPanel" class="rules-text" style="display:none;"></div>
                <label><input type="checkbox" id="accept" onchange="updateSummary()"> Confirm that you will abide by the rules</label>
                <button onclick="confirmBooking()" id="confirmBtn" disabled>Confirm</button>
            </div>
        </div>
    </div>
</div>
<script>
    let data = { 
        policy: { messages: { 
            header: 'Booking days: Member/Parents 180 days, Temp Members 60–90, Groups 180. Choose valid dates; max rooms as per rules.', 
            disclaimer: 'Room allocation is subject to rules and availability; the Club may alter assigned rooms/blocks on arrival.' 
        }}, 
        rules: `See attached rules document.`, // You can replace with the full rule text if desired
        rooms: [/* Use your original rooms array here */],
        seasons: [/* Use your original seasons array here */]
    };
    let state = { checkIn: null, checkOut: null, party: {members:0,seniors:0,kidsU10:0,parents:0,tempMembers:0,group:0}, filters: {wheel:0,pet:0,ac:0,single:0,quad:0,groupR:0}, selected: [], selectedRooms: 0, veg:0, nonveg:0, accept: false, roomOccupants: {} };
    const currentDate = new Date(); // Today
    // Room config
    const blocks = ['A', 'B', 'Old C', 'New C', 'D', 'Old E', 'New E'];
    // Assembling rules for max rooms
    const maxRooms = {
        member: { weekday: 6, weekend: 1 },
        parent: { weekday: 6, weekend: 1 },
        temp: { weekday: 6, weekend: 2 },
        group: { weekday: 19, weekend: 0 }
    };

    document.getElementById('header').innerText = data.policy.messages.header;
    document.getElementById('disclaimer').innerText = data.policy.messages.disclaimer;
    document.getElementById('rulesPanel').innerText = data.rules;
    generateCalendar();
    updateFilters();
    updateSummary();
    updateDatesDisplay();

    function generateCalendar() {
        const cal = document.getElementById('calendar'); cal.innerHTML = '';
        for (let m = 0; m < 6; m++) {
            const monthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + m, 1);
            const div = document.createElement('div'); div.className = 'month';
            div.innerHTML = `<h3>${monthDate.toLocaleDateString('en-US',{month:'long',year:'numeric'})}</h3><div class="grid">${['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=>`<div>${d}</div>`).join('')}</div>`;
            const grid = div.querySelector('.grid');
            const firstDay = monthDate.getDay();
            const daysInMonth = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0).getDate();
            // Empty cells before first day
            for (let e = 0; e < firstDay; e++) grid.innerHTML += '<div></div>';
            // Days of month
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(monthDate.getFullYear(), monthDate.getMonth(), d);
                const cell = document.createElement('div'); cell.className = 'date-cell';
                cell.innerHTML = `<div class="date-num">${d}</div><div class="room-qty">39</div>`;
                if (date < currentDate.setHours(0,0,0,0)) cell.classList.add('old-date');
                if (isWeekend(date)) cell.classList.add('weekend');
                const seasonTag = getSeasonTag(date);
                if (seasonTag) cell.classList.add(seasonTag);
                if (state.checkIn && state.checkOut && date >= state.checkIn && date <= state.checkOut) cell.classList.add('selected');
                cell.onclick = () => {
                    if (date < new Date(new Date().setHours(0,0,0,0))) return;
                    selectDate(new Date(date));
                };
                grid.appendChild(cell);
            }
            // Empty cells after
            const totalCells = 42 - firstDay - daysInMonth;
            for (let e = 0; e < totalCells; e++) grid.appendChild(document.createElement('div'));
            cal.appendChild(div);
        }
    }

    function selectDate(date) {
        if (!state.checkIn) state.checkIn = new Date(date);
        else if (!state.checkOut) {
            if (date > state.checkIn) state.checkOut = new Date(date);
            else state.checkIn = new Date(date);
        } else if (date < state.checkIn) { state.checkIn = new Date(date); state.checkOut = null;}
        else if (date > state.checkOut) state.checkOut = new Date(date);
        else { state.checkIn = new Date(date); state.checkOut = null;}
        generateCalendar();
        updateSummary();
        updateDatesDisplay();
    }

    function updateDatesDisplay() {
        const inStr = state.checkIn ? state.checkIn.toLocaleDateString() : '?';
        const outStr = state.checkOut ? state.checkOut.toLocaleDateString() : '?';
        document.getElementById('datesDisplay').innerText = `Check-in: ${inStr} | Check-out: ${outStr}`;
    }

    function isWeekend(d) { return d.getDay() === 0 || d.getDay() === 6; }
    function getSeasonTag(d) {
        const s = data.seasons.find(se => d >= new Date(se.from) && d <= new Date(se.to));
        return s ? s.tag : null;
    }

    function updateParty() {
        // Clamp maximums per rules for room types
        state.party.members = parseInt(document.getElementById('members').value) || 0;
        state.party.seniors = parseInt(document.getElementById('seniors').value) || 0;
        state.party.kidsU10 = parseInt(document.getElementById('kidsU10').value) || 0;
        state.party.parents = parseInt(document.getElementById('parents').value) || 0;
        state.party.tempMembers = parseInt(document.getElementById('tempMembers').value) || 0;
        state.party.group = parseInt(document.getElementById('group').value) || 0;
        enforceMaxRooms();
        updateSummary();
        updateMeals();
    }

    function enforceMaxRooms() {
        // Look up eligibility and max rooms
        let weekday = state.checkIn && !isWeekend(state.checkIn);
        let maxMember = weekday ? maxRooms.member.weekday : maxRooms.member.weekend;
        let maxParent = weekday ? maxRooms.parent.weekday : maxRooms.parent.weekend;
        let maxTemp = weekday ? maxRooms.temp.weekday : maxRooms.temp.weekend;
        let maxGroup = weekday ? maxRooms.group.weekday : maxRooms.group.weekend;
        // Clamp per rule - you can refine these as needed
        document.getElementById('members').max = maxMember;
        document.getElementById('parents').max = maxParent;
        document.getElementById('tempMembers').max = maxTemp;
        document.getElementById('group').max = maxGroup;
        if (state.party.group > 0 && (state.party.group < 10 || state.party.group > 19)) {
            alert('Group = 10–19 rooms only');
            document.getElementById('group').value = 0; state.party.group = 0;
        }
    }

    function updateFilters() {
        // (unchanged filter logic)
        updateSummary();
    }

    // Rooms + Occupants box logic
    function showRooms(block) {
        const list = document.getElementById('roomList');
        // You need to add your rooms filter logic here...
        list.innerHTML = `<h4>Rooms in ${block}:</h4>`;
        // etc...
    }

    function selectRoom(roomNo,block) {
        // Add to selected array, update room count, build selectedRoomsList
        if (!state.selected.some(s => s.room_no === roomNo)) {
            state.selected.push({room_no:roomNo, block:block});
            state.selectedRooms = state.selected.length;
            buildSelectedRoomsList();
            buildRoomOccupantBox();
            updateSummary();
        }
    }

    function buildSelectedRoomsList() {
        let el = document.getElementById('selectedRoomsList');
        el.innerHTML = state.selected.map(r=>`${r.room_no} (${r.block})`).join(', ');
    }

    // Occupant count box below selected rooms
    function buildRoomOccupantBox() {
        let el = document.getElementById('roomsOccupantsBox');
        el.innerHTML = '';
        for(let i=0; i<state.selected.length; i++) {
            el.innerHTML += `<label>Room ${state.selected[i].room_no} Occupants: <select onchange="setRoomOccupant(${i},this.value)">
                ${[0,1,2,3,4].map(n=>`<option value="${n}">${n}</option>`).join('')}
            </select></label>`;
        }
    }

    function setRoomOccupant(i,v) {
        state.roomOccupants[i] = parseInt(v);
        updateSummary();
    }

    function updateMeals() {
        state.veg = parseInt(document.getElementById('veg').value)||0; 
        state.nonveg = parseInt(document.getElementById('nonveg').value)||0;
        const total = Object.values(state.party).reduce((a,b)=>a+b,0);
        document.getElementById('mealsError').innerText = state.veg + state.nonveg !== total ? 'Veg + Non-Veg must equal total occupants.' : '';
        updateSummary();
    }

    function updateSummary() {
        const totalP = Object.values(state.party).reduce((a,b)=>a+b,0);
        const nights = state.checkIn && state.checkOut ? Math.ceil((state.checkOut - state.checkIn) / (1000*60*60*24)) : 0;
        document.getElementById('summaryDates').innerText = `${nights} nights`;
        document.getElementById('summaryParty').innerText = `Occupants: ${totalP}  (Group: ${state.party.group})`;
        document.getElementById('summaryRooms').innerText = `Rooms: ${state.selectedRooms} selected`;
        document.getElementById('summaryFilters').innerText = `Filters: Wheelchair${state.filters.wheel} Pets${state.filters.pet} AC${state.filters.ac} Single${state.filters.single} 4Beds${state.filters.quad} GroupR${state.filters.groupR}`;
        document.getElementById('summaryTotal').innerText = `Est. Total: ₹${totalP * 5250 * nights}`;
        state.accept = document.getElementById('accept').checked;
        let valid = state.accept && totalP > 0 && state.checkIn && state.checkOut && (state.veg + state.nonveg === totalP);
        document.getElementById('confirmBtn').disabled = !valid;
    }

    function toggleRules() {
        const p = document.getElementById('rulesPanel'); p.style.display = p.style.display === 'none' ? 'block' : 'none';
    }

    function confirmBooking() {
        alert('Demo confirmed! An email has been sent to you. Please reply to the mail.');
        document.getElementById('confirmBtn').disabled = true;
    }
</script>
</body>
</html>
